{"version":3,"sources":["webpack://i18n/./lib/index.js","webpack://i18n/./node_modules/@babel/runtime/helpers/interopRequireDefault.js","webpack://i18n/./node_modules/@babel/runtime/helpers/typeof.js","webpack://i18n/webpack/bootstrap","webpack://i18n/webpack/startup"],"names":["callback","context","language","viewer","getAttribute","test","url","translator","json","cache","key","separator","keys","split","value","length","shift","undefined","Promise","resolve","reject","request","e1","Error","xhr","XMLHttpRequest","addEventListener","this","status","statusText","JSON","parse","responseText","e","open","send","t1","t2","module","exports","obj","__esModule","_typeof","Symbol","iterator","constructor","prototype","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__"],"mappings":"0GAuEO,SAAcA,GAQlB,IAR4BC,EAQ5B,uDARsC,CACrCC,SAAU,WACN,IAAMA,EAAWC,OAAOC,aAAa,qBACrC,MAAO,KAAKC,KAAKH,GAAY,KAAOA,GAExCI,IAAK,SAACJ,GACF,2CAAqCA,EAArC,WAGEK,EAAa,SAACC,GAAD,IAAOC,EAAP,uDAAe,GAAf,OAAsB,WAEpC,IADDC,EACC,uDADK,GAAIC,EACT,uDADqB,QAEtB,GAAoB,YAAhB,aAAOH,IAAsBA,GAGd,iBAARE,EAAX,CAGA,GAAIA,KAAOD,EACP,OAAOA,EAAMC,GAGjB,IADA,IAAIE,EAAOF,EAAIG,MAAMF,GAAYG,EAAQN,EAClCE,GAAOE,EAAKG,OAAS,GACH,YAAjB,aAAOD,IAAgC,OAAVA,GAGjCA,EAAQA,EAAMF,EAAKI,SAEvB,OAAIN,GAAOE,EAAKG,OAAS,EACdN,EAAMC,QAAOO,EAEjBR,EAAMC,GAAOI,KAExB,GAAI,MAAOd,EACP,OAAO,IAAIkB,SAAQ,SACfC,EAASC,GADM,OAEdC,EAAQ,CACTpB,UAASkB,UAASC,OAAQ,SAACE,GAAD,OAAQD,EAAQ,CACtCpB,QAAS,CAAEK,IAAKL,EAAQK,IAAKJ,SAAU,iBAAM,OAC7CiB,UAASC,OAAQ,kBAAMA,EAAOE,YAI1C,GAAwB,mBAAbtB,EAUP,MAAM,IAAIuB,MAAM,2BAEpB,SAASF,EAAT,GAEG,QADCpB,QAAWK,EACZ,EADYA,IAAKJ,EACjB,EADiBA,SAAYiB,EAC7B,EAD6BA,QAASC,EACtC,EADsCA,OAE/BI,EAAM,IAAIC,eAChBD,EAAIE,iBAAiB,QAAQ,WACzB,GAAoB,MAAhBC,KAAKC,OACLR,EAAOO,KAAKE,gBACT,CACH,IAAIrB,EAAO,KACX,IACIA,EAAOsB,KAAKC,MAAMJ,KAAKK,cACzB,MAAOC,GACLb,EAAOa,GAEXd,EAAQZ,EAAWC,QAG3BgB,EAAIE,iBAAiB,SAAS,WAC1BN,EAAOO,KAAKK,iBAEhBR,EAAIU,KAAK,MAAO5B,EAAIJ,MACpBsB,EAAIW,OAhCJd,EAAQ,CACJpB,UAASkB,QAAS,SAACiB,GAAD,OAAQpC,EAAS,KAAMoC,IACzChB,OAAQ,SAACE,GAAD,OAAQD,EAAQ,CACpBpB,QAAS,CAAEK,IAAKL,EAAQK,IAAKJ,SAAU,iBAAM,OAC7CiB,QAAS,SAACkB,GAAD,OAAQrC,EAAS,KAAMqC,IAChCjB,OAAQ,kBAAMpB,EAASsB,EAAI,a,qBClH3CgB,EAAOC,QANP,SAAgCC,GAC9B,OAAOA,GAAOA,EAAIC,WAAaD,EAAM,CACnC,QAAWA,K,QCFf,SAASE,EAAQF,GAaf,MAVsB,mBAAXG,QAAoD,iBAApBA,OAAOC,SAChDN,EAAOC,QAAUG,EAAU,SAAiBF,GAC1C,cAAcA,GAGhBF,EAAOC,QAAUG,EAAU,SAAiBF,GAC1C,OAAOA,GAAyB,mBAAXG,QAAyBH,EAAIK,cAAgBF,QAAUH,IAAQG,OAAOG,UAAY,gBAAkBN,GAItHE,EAAQF,GAGjBF,EAAOC,QAAUG,ICfbK,EAA2B,GCE/B,ODCA,SAASC,EAAoBC,GAE5B,GAAGF,EAAyBE,GAC3B,OAAOF,EAAyBE,GAAUV,QAG3C,IAAID,EAASS,EAAyBE,GAAY,CAGjDV,QAAS,IAOV,OAHAW,EAAoBD,GAAUX,EAAQA,EAAOC,QAASS,GAG/CV,EAAOC,QCjBRS,CAAoB,M","file":"index.min.js","sourcesContent":["/* global viewer */\n/**\n * @callback i18n_callback\n * @param {Error|null} error\n *  an error or `null` if `translator` function can be provided\n * @param {Function} translator\n *  a function with a `(key: string, separator?: string|RegEx)` signature\n */\n/**\n * Promises a `translator` function, which takes a key and returns a value. The\n * `i18n` internationalization fetches a JSON file named\n *\n * ```\n * translation.${language}.json\n * ```\n *\n * from a `url`, where the latter (plus the `language`) are determined by\n * default by the `context` of a dizmo. But, by providing a custom `context`\n * (to `i18n` as a 2nd argument) these defaults can be overridden (and hence\n * decoupled from a dizmo).\n *\n * If a `callback` &ndash; with an `(error, translator)` signature &ndash; is\n * provided then *instead* of returning a promise (for the `translator`), the\n * `callback` is invoked with `(null, translator)` arguments (in case of a\n * success), or with `(error, null)` arguments (in case of an error); for\n * example:\n *\n * ```js\n * i18n((e, t) => { if (e) console.error(e) else ... })\n * ```\n *\n * If the `callback` is *not* provided, then the `translator` function is\n * returned (or a corresponding `error` exception is thrown); for example:\n *\n * ```js\n * let t; try { t = await i18n(); ... } catch (e) { console.error(e) }\n * ```\n *\n * Once the `translator` function is successfully acquired, it can be used to\n * access (deeply nested) keys; for example:\n *\n * ```js\n * const value_a = t('my/example/key/a');\n * ```\n * ```js\n * const value_b = t('my.example.key.a');\n * ```\n *\n * By default, only the forward slash `/` and the period `.` separators\n * are available. However, it is possible to provide custom separators,\n * via either a string or a regular expression:\n *\n * ```js\n * const value_c = t('my:example:key:c', ':');\n * ```\n * ```js\n * const value_d = t('my|example|key|c', /|/);\n * ```\n *\n * @param {i18n_callback|undefined} callback\n *  a function with an `(error, translator)` signature, where `translator` is a\n *  function with a `(key: string, separator?: string|RegEx)` signature\n *\n * @param {{language:Function,url:Function}|undefined} context?\n *  an (optional) dictionary with context information for the `language` and\n *  `url` selectors\n *\n * @returns {Promise<Function>|undefined}\n *  a promise for a `translator` function (or `undefined` if a `callback` has\n *  been provided)\n */\nexport function i18n(callback, context = {\n    language: () => {\n        const language = viewer.getAttribute('settings/language');\n        return /c/i.test(language) ? 'en' : language;\n    },\n    url: (language) => {\n        return `assets/locales/translation.${language}.json`;\n    }\n}) {\n    const translator = (json, cache = {}) => (\n        key = '', separator = /\\/|\\./\n    ) => {\n        if (typeof json !== 'object' || !json) {\n            return undefined;\n        }\n        if (typeof key !== 'string') {\n            return undefined;\n        }\n        if (key in cache) {\n            return cache[key];\n        }\n        let keys = key.split(separator), value = json;\n        while (key && keys.length > 0) {\n            if (typeof value !== 'object' || value === null) {\n                break;\n            }\n            value = value[keys.shift()];\n        }\n        if (key && keys.length > 0) {\n            return cache[key] = undefined;\n        }\n        return cache[key] = value;\n    };\n    if (typeof callback === 'undefined' || callback === null) {\n        return new Promise((\n            resolve, reject\n        ) => request({\n            context, resolve, reject: (e1) => request({\n                context: { url: context.url, language: () => 'en' },\n                resolve, reject: () => reject(e1)\n            })\n        }));\n    }\n    if (typeof callback === 'function') {\n        request({\n            context, resolve: (t1) => callback(null, t1),\n            reject: (e1) => request({\n                context: { url: context.url, language: () => 'en' },\n                resolve: (t2) => callback(null, t2),\n                reject: () => callback(e1, null)\n            })\n        });\n    } else {\n        throw new Error('callback not a function');\n    }\n    function request({\n        context: { url, language }, resolve, reject\n    }) {\n        const xhr = new XMLHttpRequest();\n        xhr.addEventListener('load', function () {\n            if (this.status !== 200) {\n                reject(this.statusText);\n            } else {\n                let json = null;\n                try {\n                    json = JSON.parse(this.responseText);\n                } catch (e) {\n                    reject(e);\n                }\n                resolve(translator(json));\n            }\n        });\n        xhr.addEventListener('error', function () {\n            reject(this.responseText);\n        });\n        xhr.open('GET', url(language()));\n        xhr.send();\n    }\n}\nexport default i18n;\n","function _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nmodule.exports = _interopRequireDefault;","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(765);\n"],"sourceRoot":""}